<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright (C) 2003-2007 eXo Platform SAS.

    This program is free software; you can redistribute it and/or
    modify it under the terms of the GNU Affero General Public License
    as published by the Free Software Foundation; either version 3
    of the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, see<http://www.gnu.org/licenses/>.

-->
<Module>
 <ModulePrefs title="Status updates">
   <Require feature="opensocial-0.7"></Require>
   <Require feature="dynamic-height"></Require>
   <Require feature="settitle"></Require>
   <Require feature="views"></Require>
   <Require feature="opensocial-i18n"></Require>
 </ModulePrefs>
 <Content type="html" view="home">
   <![CDATA[

<link rel="stylesheet" type="text/css" href="activities/style.css"></link>
<script type="text/javascript" src="activities/script.js"></script>
<script type="text/javascript">
	var statusUpdates = new StatusUpdate();
	
	function focusFirstTask(textarea) {
		if(textarea.innerHTML == "What're you doing?") {
			textarea.style.color="#000000";
			textarea.style.minHeight="20px";
			textarea.focus();
			textarea.innerHTML = "";
			textarea.appendChild(document.createElement('br'));
		}
	}
	
	function getTextContent (el)
	{
		
		if (el.textContent) {
			return el.textContent.replace(/&nbsp;/g,' ').replace(/<br>/gi, " ").replace(/<p>/gi, " ").replace(/<\/\p>/gi, " ");
		}
		
		if (el.innerText) {
			return el.innerText.replace(/&nbsp;/g,' ').replace(/<br>/gi, " ").replace(/<p>/gi, " ").replace(/<\/\p>/gi, " ");
		}
		
		if (el.innerHTML) {
			return el.innerHTML.replace(/&nbsp;/g,' ').replace(/<br>/gi, " ").replace(/<p>/gi, " ").replace(/<\/\p>/gi, " ");
		}
		
		return null;
	}
		
	function lostFocus(textarea) {
		var text = getTextContent(textarea);
		if (text != null) {
			var content = text.replace(/^\s+/g, '').replace(/\s+$/g, '');
		}
		
		if((text == null) || (content == "")) {
			textarea.style.color="#777777";
			textarea.innerHTML = "What're you doing?";
			textarea.style.minHeight="12px";
			textarea.removeChild(textarea.getElementsByTagName('br'));
		}
	}
	
	gadgets.util.registerOnLoadHandler(statusUpdates.init());
</script>

<div class="GadgetContent">
	<div class="ActivityForm">
		<div id="newActivity" name="activityInputBox" style="min-height:12px;" class="UIComposer_InputArea" contenteditable="true" onfocus="focusFirstTask(this);" onBlur="lostFocus(this);">What're you doing?</div>
		<div class="AddActivityForm">
			<div class="ButtonAdd" onclick="eXo.social.statusUpdate.postNewActivity(); return false;"> Add</div>
			<div class="ClearBoth"><span></span></div>
		</div>
	</div>
	<div id="ActivitiesContainer">
	</div>
</div>
<div id="more" style="text-align:right;"></div>
</div>
]]>
</Content>
<Content type="html" view="canvas">
   <![CDATA[

<link rel="stylesheet" type="text/css" href="activities/CanvasModeStyleSheet.css"></link>
<script type="text/javascript" src="activities/script.js"></script>
<script type="text/javascript">
	var statusUpdates = new StatusUpdate();
	
	function focusFirstTask(textarea) {
		eXo.social.statusUpdate.active=true;
		if(textarea.innerHTML == "What're you doing?") {
			textarea.style.color="#000000";
			textarea.focus();
			textarea.style.minHeight="30px";
			textarea.innerHTML = "";
			textarea.appendChild(document.createElement('br'));
		}
	}
	
	function getTextContent (el)
	{
		
		if (el.textContent) {
			return el.textContent.replace(/&nbsp;/g,' ').replace(/<br>/gi, " ").replace(/<p>/gi, " ").replace(/<\/\p>/gi, " ");
		}
		
		if (el.innerText) {
			return el.innerText.replace(/&nbsp;/g,' ').replace(/<br>/gi, " ").replace(/<p>/gi, " ").replace(/<\/\p>/gi, " ");
		}
		
		if (el.innerHTML) {
			return el.innerHTML.replace(/&nbsp;/g,' ').replace(/<br>/gi, " ").replace(/<p>/gi, " ").replace(/<\/\p>/gi, " ");
		}
		
		return null;
	}
		
	function lostFocus(textarea) {
	
		var text = getTextContent(textarea);
		if (text != null) {
			var content = text.replace(/^\s+/g, '').replace(/\s+$/g, '');
		}
		if((text == null) || (content == "")) {
			eXo.social.statusUpdate.active=false;
			textarea.style.color="#777777";
			textarea.innerHTML = "What're you doing?";
			textarea.style.minHeight="20px";
			textarea.removeChild(textarea.getElementsByTagName('br'));
		} else {
			eXo.social.statusUpdate.active=true;
		}
	}
	
	gadgets.util.registerOnLoadHandler(statusUpdates.init());
</script>

<div class="GadgetContent">
	<div class="ActivityForm">
		<div id="newActivity" name="activityInputBox" class="UIComposer_InputArea" contenteditable="true" onfocus="focusFirstTask(this);" onBlur="lostFocus(this);">What're you doing?</div>
		<div class="AddActivityForm">
			<div class="ButtonAdd" onclick="eXo.social.statusUpdate.postNewActivity(); return false;"> Add</div>
			<div class="ClearBoth"><span></span></div>
		</div>
	</div>
	<div id="ActivitiesContainer">
	</div>
</div>
<div id="more" style="text-align:right;"></div>
</div>

]]>
</Content>
</Module>